ALTER PROCEDURE [dbo].[SP_VisitorSelfRegistration_CURD]
@Id int = null,
@Firstname nvarchar(1000) = '',
@Lastname nvarchar(1000) = '',
@CompanyId uniqueidentifier = null,
@Code nvarchar(100) = null,
@CompanyName nvarchar(1000) = '',
@VisitorreasonIds nvarchar(100) = '',
@VisitorTypeIds nvarchar(100) = '',
@PhoneNumber nvarchar(100) = '',
@EmailId nvarchar(100) = '',
@NationalId nvarchar(100) = '',
@HostEmployeeCode nvarchar(100) = '',
@AccessCardNumber nvarchar(100) = '',
@ValidFrom nvarchar(100) = '',
@ValidTo nvarchar(100) = '',
@CheckId nvarchar(100) = '',
@CheckOut nvarchar(100) = '',
@StatusId int = null,
@VisitorRegNumber nvarchar(100) = '',
@ServiceIds nvarchar(100) = '',
@ImagePath nvarchar(1000) = '',
@ImageBase64 varchar(max) = null,
@Isactive bit = 0,
@CreatedBy uniqueidentifier=null,
@ModifiedBy uniqueidentifier=null,
@ActionType nvarchar(20) = ''
AS

BEGIN
    IF @ActionType = 'Insert'
	BEGIN
	    INSERT INTO Tbl_Mstr_Visitor_Master 
		(
		   FirstName,LastName,CompanyId,Code,CompanyName,VisitorreasonIds,VisitorTypeIds,PhoneNumber,EmailId,NationalId,HostEmployeeCode,AccessCardNumber,ValidFrom,ValidTo,CheckId,CheckOut,StatusId,
		   VisitorRegNumber,ServiceIds,VisitorPreRegStatus,ImagePath,ImageBase64,IsActive,CreatedDate,ModifiedDate,CreatedBy
		)
		VALUES
		(
		 @FirstName,@LastName,@CompanyId,@Code,@CompanyName,@VisitorreasonIds,@VisitorTypeIds,@PhoneNumber,@EmailId,@NationalId,@HostEmployeeCode,@AccessCardNumber,@ValidFrom,@ValidTo,@CheckId,
		 @CheckOut,@StatusId,@VisitorRegNumber,@ServiceIds,'PreRegistered',@ImagePath,@ImageBase64,1,GETDATE(),GETDATE(),@CreatedBy
		)
	END
	IF @ActionType = 'Edit' OR @ActionType='Remote'
	BEGIN  
		select C.Id,
		       C.FirstName,
		       C.LastName,
			   C.CompanyId,
			   C.Code,
			   C.CompanyName,
			   C.VisitorreasonIds,
			   C.VisitorTypeIds,
			   C.PhoneNumber,
			   C.EmailId,
			   C.NationalId,
			   C.HostEmployeeCode,
			   C.AccessCardNumber,
			   C.ValidFrom,
			   C.ValidTo,
			   C.CheckId,
			   C.CheckOut,
			   C.StatusId,
		       C.VisitorRegNumber,
			   C.ServiceIds,
			   C.VisitorPreRegStatus,
			   C.ImagePath,
			   C.ImageBase64,
			   C.IsActive
		from Tbl_Mstr_Visitor_Master C 
		WHERE C.Id=@Id  and CompanyId=@CompanyId
	END  

	IF @ActionType = 'Update'
	BEGIN
	      UPDATE Tbl_Mstr_Visitor_Master
		  SET FirstName = @Firstname,
		      LastName = @Lastname,
			  Code = @Code,
			  CompanyName = @CompanyName,
			  VisitorreasonIds = @VisitorreasonIds,
			  VisitorTypeIds = @VisitorTypeIds,
			  PhoneNumber = @PhoneNumber,
			  EmailId = @EmailId,
			  NationalId = @NationalId,
			  HostEmployeeCode = @HostEmployeeCode,
			  AccessCardNumber = @AccessCardNumber,
			  ValidFrom = @ValidFrom,
			  ValidTo = @ValidTo,
			  CheckId = @CheckId,
			  CheckOut = @CheckOut,
			  StatusId = @StatusId,
			  VisitorRegNumber = @VisitorRegNumber,
			  ServiceIds = @ServiceIds,
			  ImagePath = @ImagePath,
			  ImageBase64 = @ImageBase64,
			  IsActive = @Isactive,
			  ModifiedDate = GETDATE()
			  WHERE Id = @Id
	END

	IF @ActionType = 'Delete'
	BEGIN  
		DELETE from Tbl_Mstr_Visitor_Master 
		WHERE Id=@Id
	END  
END